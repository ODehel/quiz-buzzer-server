<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Authentification QuizBuzzer</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 5px; }
        #log { background: #f0f0f0; padding: 10px; margin-top: 20px; height: 400px; overflow-y: scroll; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>üîê Test Authentification</h1>
    
    <div>
        <h2>Authentification simple (dev)</h2>
        <input type="text" id="username" placeholder="Username (ex: admin)" value="admin">
        <button onclick="simpleAuth()">Se connecter</button>
    </div>

    <div>
        <h2>Actions prot√©g√©es</h2>
        <button onclick="createQuestion()">Cr√©er une question (requiert auth)</button>
        <button onclick="getQuestions()">Lister les questions (public)</button>
    </div>

    <div id="log"></div>

    <script>
        let token = null;

        function log(message) {
            const div = document.getElementById('log');
            div.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${message}</div>`;
            div.scrollTop = div.scrollHeight;
        }

        async function simpleAuth() {
            const username = document.getElementById('username').value;
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/simple', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: username })
                });

                const text = await response.text(); // ‚úÖ Lire comme texte d'abord
                log(`R√©ponse brute: ${text}`);      // ‚úÖ Afficher pour diagnostiquer
        
                const data = JSON.parse(text);      // Ensuite parser
                
                if (data.success) {
                    token = data.token;
                    log(`‚úÖ Authentifi√© ! Token: ${token.substring(0, 20)}...`);
                } else {
                    log(`‚ùå Erreur: ${data.error}`);
                }
            } catch (error) {
                log(`‚ùå Erreur r√©seau: ${error.message}`);
            }
        }

        async function createQuestion() {
            if (!token) {
                log('‚ùå Vous devez vous connecter d\'abord !');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/questions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        text: 'Question test cr√©√©e via API',
                        type: 'MCQ',
                        answers: ['R√©ponse A', 'R√©ponse B', 'R√©ponse C', 'R√©ponse D'],
                        correct_answer: 0,
                        category: 'Test',
                        difficulty: 1,
                        points: 10
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ Question cr√©√©e ! ID: ${data.id}`);
                } else {
                    log(`‚ùå Erreur: ${data.error}`);
                }
            } catch (error) {
                log(`‚ùå Erreur r√©seau: ${error.message}`);
            }
        }

        async function getQuestions() {
            try {
                const response = await fetch('http://localhost:3000/api/questions');
                const data = await response.json();
                
                log(`‚úÖ ${data.length} questions trouv√©es`);
                console.log(data);
            } catch (error) {
                log(`‚ùå Erreur r√©seau: ${error.message}`);
            }
        }
    </script>
</body>
</html>